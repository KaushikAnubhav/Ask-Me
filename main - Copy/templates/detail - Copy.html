{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Page</title>
    <!-- Bootstrap 4 -->
    <link rel="stylesheet" href="{% static 'animate.min.css' %}" />
    <!-- Bootstrap 4 -->
    <link rel="stylesheet" href="{% static 'bootstrap.min.css' %}" />
    <!-- Font Awesome 4 -->
    <link rel="stylesheet" href="{% static 'fa4/css/font-awesome.min.css' %}" />
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">AskMe</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <form class="ml-auto" action="/">
                    <div class="input-group">
                        <input type="text" name="q" class="form-control" placeholder="Search" />
                        <div class="input-group-append">
                        <button class="btn btn-success" type="submit" id="button-addon2">Search</button>
                        </div>
                    </div>
                </form>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Questions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Tags</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Ask</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Profile</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Question List -->
    <div class="container">
        <h2 class="my-4">{{quest.title}}</h2>
        <p>{{quest.detail}}</p>
        <p>
            <span class="mr-4">{{quest.add_time|date:'d/m/Y'}}</span>
            <a href="#">{{quest.user.username}}</a>
        </p>
        <hr/>
        {% for answer in answers %}
        <div class="row">
            <div class="col-1">
                <div class="upvote">
                    <strong>123</strong><br/>
                    <span class="text-success">
                        <i class="fa fa-arrow-up fa-2x"></i>
                    </span>
                </div>
                <div class="downvote mt-3">
                    <span class="text-danger">
                        <i class="fa fa-arrow-down fa-2x"></i>
                    </span><br/>
                    <strong>123</strong>
                </div>
            </div>
            <div class="col-11">
                <p>
                    {{ answer.detail }}
                </p>
                <p>
                    <a href="#" class="mr-3">{{answer.user.username}}</a>
                    <span class="mr-3">5 comments</span>
                    <span>{{answer.add_time|date:'d/m/Y h:i:s'}}</span>
                </p>
                <p>
                    tags:
                    {% for tag in tags %}
                    <a href="#" class="badge badge-secondary p-1">{{tag}}</a>
                    {% endfor %}
                </p>
                <!-- Comment Section Start -->
                <h3 class="my-4">Comment</h3>
                <div class="comment-wrapper">
                    {% for comment in answer.comment_set.all %}
                    <div class="card mb-2">
                        <div class="card-body">
                            <p>{{comment.comment}}</p>
                            <p>
                                <a href="#">{{comment.user.username}}</a>
                            </p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Comment Form -->
                <div class="card my-3">
                    <h6 class="card-header">Add Comment</h6>
                    <div class="card-body">
                        {% if user.is_authenticated %}
                        <textarea class="form-control comment-text"></textarea>
                        <button data-answer="{{answer.id}}" class="btn btn-dark my-2 save-comment" type="button">Submit</button>
                        {% else %}
                        <p class="card-text"><a href="#">Login to comment</a></p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <hr/>
        {% endfor %}
    </div>
<!-- Load Jquery -->
<script src="{% static 'jquery-3.5.1.min.js' %}"></script>
<script>
    $(document).ready(function(){
        $(".save-comment").on('click',function(){
            var _commentText=$(".comment-text").val();
            var _answerId=$(this).data('answer');
            // console.log(_answerId,_commentText);
            // return false;
            // Run Ajax
            $.ajax({
                url:"/save-comment",
                type:'post',
                dataType:'json',
                data:{
                   comment:_commentText,
                   answerId:_answerId,
                   csrfmiddlewaretoken:"{{csrf_token}}"
                },
                beforeSend:function(){
                    $(".save-comment").addClass('disabled').text('saving...');
                },
                success:function(res){
                    var _html='';
                    _html+='<div class="card mb-2 animate__animated animate__bounce">\
                    <div class="card-body">\
                        <p>'+_commentText+'</p>\
                        <p>\
                            <a href="#">{{request.user}}</a>\
                        </p>\
                    </div>\
                </div>';
                $(".comment-wrapper").append(_html);
                $(".save-comment").removeClass('disabled').text('Submit');
                }
            });
        });
    });
</script>
</body>
</html>